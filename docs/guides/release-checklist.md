# Release Checklist

> **Последнее обновление:** 2025-11-04

## Preflight-проверка проекта

- Выровнять версии Node.js 20 и pnpm 9+, удалить неиспользуемые пакеты, обновить lock-файл при необходимости.
- Синхронизировать `.env.example` и `.env`: флаги `NAV_V1`, `APP_LOCALE`, `FIN_EXPENSES_STORAGE`, демо-проекты и dev-токены.
- Убедиться, что `pnpm dev` запускает маркетинговую главную и приложение без ошибок.
- Зафиксировать единый набор команд в `package.json`/CI для `pnpm verify`.

## Структура маршрутов и заглушки

- Проверить дерево `apps/web/app` на наличие ключевых layout'ов: `(marketing)`, `(app)`, `projects/[id]`.
- Для обязательных страниц `/`, `/app`, `/projects/demo` убедиться в наличии `page.tsx`, `layout.tsx`, `loading.tsx`, `error.tsx`, `not-found.tsx`.
- Пройтись по навигации (`apps/web/config/MarketingMenu.config.ts`, мобильное меню, футер) и добавить заглушки `page.tsx` там, где маршрутов нет.
- Подготовить заглушки для карточек специалистов, блоговых разделов и других ссылок навигации.
- Добавить `apps/web/app/api/health/route.ts` с ответом `{ status: 'ok' }` без внешних запросов.

## Навигация и доступность

- Провести аудит мегаменю (`apps/web/components/marketing/MarketingMegaMenu.tsx`): `aria-expanded`, `aria-controls`, обработка `Enter`/`Space`/стрелок, закрытие по `Escape` и `onBlur`.
- Расширить e2e-тесты (`apps/web/tests/e2e/menu-desktop.spec.ts`) проверкой клавиатурного управления и закрытия по фокусу.
- Проверить мобильное меню (`apps/web/components/marketing/MarketingMobileNav.tsx`): бургер-кнопка, аккордеон подпунктов, перенос фокуса.
- Добавить e2e-тесты для мобильного меню и падение теста при `console.error`/`console.warn`.

## Границы ошибок и состояния загрузки

- Глобальные `error.tsx`, `not-found.tsx`, `loading.tsx` на верхнем уровне и в ключевых сегментах `(marketing)`, `(app)`, `projects/[id]`.
- Для вкладок `apps/web/app/(app)/projects/[id]/(tabs)` добавить локальные boundaries и кнопку «Повторить».
- Обработать сценарий неизвестного `id` через `notFound()` в загрузчике/серверном компоненте.
- Добавить e2e-сценарий с имитацией ошибки вкладки и проверкой кнопки «Повторить».

## Данные и устойчивость

- Расширить схемы Zod в `apps/web/lib/mock/schemas.ts` под все моки маркетинга и приложения.
- Обновить лоадеры (`apps/web/lib/mock/loaders.ts`) для безопасного пустого ответа и dev-логирования.
- Удалить внешние запросы из `sitemap.ts`, `robots.ts` и прочих файлов сборки, заменить локальными моками.
- Пересмотреть локальный поиск: зафиксировать собственные типы, избегать конфликтов с внешними пакетами.

## Стабильность гидрации

- Проверить, что интерактивные компоненты объявлены как клиентские и не смешивают серверные/клиентские хуки.
- Запустить `pnpm dev`, пройти ключевые страницы, устранить предупреждения гидрации.
- Добавить e2e-проверку на отсутствие `console.error`/`console.warn` во время навигации.

## Конфигурация Vercel

- Обновить `vercel.json`/настройки: корневая директория `apps/web`, команды `pnpm verify`/`pnpm build`, старт `pnpm start`, Node.js 20, pnpm 9.
- Настроить переменные окружения для preview и production (локаль, флаги навигации, демо-данные).
- Проверить `vercel build --prod` на отсутствие ошибок «файл не найден», особенно для зеркальных маршрутов.

## Тестирование и контроль качества

- Запустить `pnpm verify`, убедиться в отсутствии предупреждений/ошибок.
- После симуляции Vercel повторить e2e-смоук: маркетинговые страницы, дашборд, демо-проект, публичные заглушки, меню.
- Составить чек-лист ручного тестирования: маркетинговые страницы, дашборд, демо-проект, публичные заглушки, состояния 404/500, health-endpoint.
- Подготовить инструкцию для QA по проверке превью-деплоя Vercel.

## Готовность к публикации

- Задеплоить превью в Vercel, подтвердить доступность главной, маркетинговых подразделов, дашборда и демо-проекта.
- Зафиксировать дату и номер RC, обновить документацию (README, release-notes) ссылками на превью.
- Настроить мониторинг health-endpoint и базовые алерты перед открытием доступа.
